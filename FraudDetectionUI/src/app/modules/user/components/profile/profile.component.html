<div class="profile-page">
  <!-- Page Title -->
  <div class="page-title">
    <h1>My Profile</h1>
    <p>Manage your personal information and security settings</p>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading && !profile">
    <div class="spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Error Alert -->
  <div class="alert alert-danger" *ngIf="error">
    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
    </svg>
    {{ error }}
    <button class="close-btn" (click)="error = ''">&times;</button>
  </div>

  <!-- Success Alert -->
  <div class="alert alert-success" *ngIf="success">
    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
    </svg>
    {{ success }}
  </div>

  <div class="profile-content" *ngIf="profile">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="avatar-section">
        <div class="avatar">{{ getInitials() }}</div>
        <div class="user-info">
          <h1>{{ profile.firstName }} {{ profile.lastName }}</h1>
          <p class="email">{{ profile.email }}</p>
          <span class="role-badge" [ngClass]="profile.role.toLowerCase()">
            <svg *ngIf="profile.role === 'Admin'" width="12" height="12" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 012.166 5C2.056 5.649 2 6.319 2 7c0 5.225 3.34 9.67 8 11.317C14.66 16.67 18 12.225 18 7c0-.682-.057-1.35-.166-2.001A11.954 11.954 0 0110 1.944z" clip-rule="evenodd"/>
            </svg>
            <svg *ngIf="profile.role !== 'Admin'" width="12" height="12" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            {{ profile.role === 'Admin' ? 'Administrator' : 'User' }}
          </span>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="openPasswordModal()">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
          </svg>
          Change Password
        </button>
        <button class="btn btn-primary" *ngIf="!isEditing" (click)="startEditing()">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
          </svg>
          Edit
        </button>
      </div>
    </div>

    <div class="profile-grid">
      <!-- Personal Information -->
      <div class="profile-card">
        <div class="card-header">
          <h3>
            <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            Personal Information
          </h3>
          <span class="member-since">Member since {{ getMemberSince() }}</span>
        </div>
        <div class="card-body">
          <form *ngIf="!isEditing">
            <div class="info-row">
              <label>First Name</label>
              <span>{{ profile.firstName }}</span>
            </div>
            <div class="info-row">
              <label>Last Name</label>
              <span>{{ profile.lastName }}</span>
            </div>
            <div class="info-row">
              <label>Email Address</label>
              <span>{{ profile.email }}</span>
            </div>
            <div class="info-row">
              <label>Account Type</label>
              <span>{{ profile.role === 'Admin' ? 'Administrator' : 'User' }}</span>
            </div>
          </form>

          <form *ngIf="isEditing" class="edit-form">
            <div class="form-group">
              <label>First Name</label>
              <input type="text" [(ngModel)]="editForm.firstName" name="firstName">
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <input type="text" [(ngModel)]="editForm.lastName" name="lastName">
            </div>
            <div class="form-group">
              <label>Email Address</label>
              <input type="email" [(ngModel)]="editForm.email" name="email">
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" (click)="cancelEditing()">Cancel</button>
              <button type="button" class="btn btn-primary" (click)="saveProfile()" [disabled]="loading">
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
                </svg>
                Save
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Account Statistics -->
      <div class="profile-card">
        <div class="card-header">
          <h3>
            <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zm6-4a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zm6-3a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
            </svg>
            Account Statistics
          </h3>
        </div>
        <div class="card-body">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-icon accounts">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                  <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-info">
                <span class="stat-value">{{ profile.stats.accountCount }}</span>
                <span class="stat-label">Bank Accounts</span>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon balance">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-info">
                <span class="stat-value">{{ profile.stats.totalBalance | number:'1.2-2' }} MAD</span>
                <span class="stat-label">Total Balance</span>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon transactions">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-info">
                <span class="stat-value">{{ profile.stats.totalTransactions }}</span>
                <span class="stat-label">Total Transactions</span>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon safe">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-info">
                <span class="stat-value">{{ profile.stats.safeTransactions }}</span>
                <span class="stat-label">Safe Transactions</span>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon fraud">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-info">
                <span class="stat-value">{{ profile.stats.fraudTransactions }}</span>
                <span class="stat-label">Suspicious Transactions</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bank Accounts -->
      <div class="profile-card full-width">
        <div class="card-header">
          <h3>
            <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
              <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V8a2 2 0 00-2-2h-5L9 4H4z"/>
            </svg>
            Bank Accounts
          </h3>
        </div>
        <div class="card-body">
          <div class="accounts-list" *ngIf="profile.accounts?.length; else noAccounts">
            <div class="account-card" *ngFor="let account of profile.accounts">
              <div class="account-icon">
                <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                  <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="account-details">
                <span class="account-number">{{ account.accountNumber }}</span>
                <span class="account-date">Opened on {{ account.createdAt | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="account-balance">
                <span class="balance-label">Balance</span>
                <span class="balance-value">{{ account.balance | number:'1.2-2' }} MAD</span>
              </div>
              <div class="account-transactions">
                <span class="trans-count">{{ account.transactionCount || 0 }}</span>
                <span class="trans-label">transactions</span>
              </div>
            </div>
          </div>
          <ng-template #noAccounts>
            <div class="empty-state">
              <svg width="48" height="48" viewBox="0 0 20 20" fill="currentColor">
                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z" clip-rule="evenodd"/>
              </svg>
              <p>No bank accounts found</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Security Settings -->
      <div class="profile-card">
        <div class="card-header">
          <h3>
            <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 012.166 5C2.056 5.649 2 6.319 2 7c0 5.225 3.34 9.67 8 11.317C14.66 16.67 18 12.225 18 7c0-.682-.057-1.35-.166-2.001A11.954 11.954 0 0110 1.944z" clip-rule="evenodd"/>
            </svg>
            Security
          </h3>
        </div>
        <div class="card-body">
          <div class="security-item">
            <div class="security-info">
              <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
              </svg>
              <div>
                <span class="security-title">Password</span>
                <span class="security-desc">Last changed: Unknown</span>
              </div>
            </div>
            <button class="btn btn-outline" (click)="openPasswordModal()">Update</button>
          </div>
          <div class="security-item">
            <div class="security-info">
              <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
              </svg>
              <div>
                <span class="security-title">Fraud Alerts</span>
                <span class="security-desc">{{ profile.stats.fraudTransactions }} alerts on your account</span>
              </div>
            </div>
            <span class="status-badge" [ngClass]="profile.stats.fraudTransactions > 0 ? 'warning' : 'success'">
              {{ profile.stats.fraudTransactions > 0 ? 'Review Required' : 'All Clear' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div class="modal-overlay" *ngIf="showPasswordModal" (click)="closePasswordModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
        </svg>
        Change Password
      </h2>
      <button class="close-btn" (click)="closePasswordModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="alert alert-danger" *ngIf="passwordError">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        {{ passwordError }}
      </div>
      <div class="form-group">
        <label>Current Password</label>
        <input type="password" [(ngModel)]="passwordForm.currentPassword" placeholder="Enter your current password">
      </div>
      <div class="form-group">
        <label>New Password</label>
        <input type="password" [(ngModel)]="passwordForm.newPassword" placeholder="Enter new password">
      </div>
      <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" [(ngModel)]="passwordForm.confirmPassword" placeholder="Confirm new password">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closePasswordModal()">Cancel</button>
      <button class="btn btn-primary" (click)="changePassword()" [disabled]="loading">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/>
        </svg>
        Update
      </button>
    </div>
  </div>
</div>
